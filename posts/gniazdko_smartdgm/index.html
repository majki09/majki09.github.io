<!DOCTYPE html>
<html lang="">
	<head>
		<title>
	Gniazdko SmartDGM
</title>
		<style>
	body {
		display: block;
		--colorBG: "#40e0d0, #ff8c00, #ff0080";
		
			background: linear-gradient(to right, var(--colorBG)) !important;
		
	}

	body, body.pushable {
		background-repeat: no-repeat;
	  	background-attachment: fixed;
	  	background-size: cover !important;
	}
</style>

		<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">


	
	
	
	<meta name="author" content="majki" />
	<meta name="description" content="Smart gniazdko SmartDGM i wgrywanie Tasmota" />



<meta name="generator" content="Hugo 0.54.0" />


<link rel="shortcut icon" href="/img/defaultFav.ico">




		
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<script
	src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>


 <link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Inconsolata" rel="stylesheet"> 



<link rel="stylesheet" type="text/css" href="/css/site.css">






	
		<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/UtkarshVerma/hugo-dream-plus/ae11561d/exampleSite/static/css/highlight.css">
	



<style>
	body.pushable {
		display: block;
		
			background: linear-gradient(to right, var(--colorBG)) !important;
		 ;
	}
</style>



<script>
	var colorBG =  true 
	
	var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
	console.log("The client device is a "+(isMobile?"mobile":"PC")+".")
</script>

	</head>

	<body>
		<script>
var prevBgIndex = 0;
var bodyBgSwitchIndex = 0;






	var gradients = [
	  [],
	  ['#40e0d0', '#ff8c00', '#ff0080'], 
	  ['#3e5151', '#decba4'], 
	  ['#11998e', '#38ef7d'], 
	  ['#108dc7', '#ef8e38'], 
	  ['#fc5c7d', '#6a82fb'], 
	  ['#fc466b', '#3f5efb'], 
	  ['#c94b4b', '#4b134f'], 
	  ['#23074d', '#cc5333'] 
	];
	document.body.style.setProperty('--colorBG', connect(gradients[getRandomInt(0, gradients.length)]));


	function getRandomInt(min, max) {
	  min = Math.ceil(min);
	  max = Math.floor(max);
	  var random;
	  while (1) {
	    random = Math.floor(Math.random() * (max - min)) + min;
	    if (random !== prevBgIndex) {
	      prevBgIndex = random;
	      break;
	    }
	  }
	  return random;
	}

	function connect(arr) {
	  var str = '';
	  for (var i = 0; i < arr.length; i++) {
	    if (i !== arr.length - 1) {
	      str += arr[i] + ', ';
	    } else {
	      str += arr[i];
	    }
	  }
	  return str;
	}
</script>




		<div id="sidebar" class="ui sidebar inverted vertical menu">
	
	<section id="author" class="ui top attached center aligned inverted segment">
		
<div class="ui small circular image">
	
		<img src="/images/ja_awatar.png">
	
</div>


<h3 class="ui header">
	majki
	<div class="sub header">Wszystko jest mo偶liwe - niemo偶liwe potrzebuje tylko wicej czasu.</div>
</h3>

	</section>

	
	
		<section class="ui attached center aligned inverted segment sidebar-dream-tags">
			
			
			
			




	
	
		
			
			<a class="ui label blue " href="/tags/domoticz" title="domoticz">domoticz</a>
		
			
			<a class="ui label blue " href="/tags/programowanie" title="programowanie">programowanie</a>
		
			
			<a class="ui label purple " href="/tags/raspberry" title="raspberry">raspberry</a>
		
			
			<a class="ui label violet " href="/tags/atmelstudio" title="atmelstudio">atmelstudio</a>
		
			
			<a class="ui label teal " href="/tags/avr" title="avr">avr</a>
		
			
			<a class="ui label orange " href="/tags/avrdude" title="avrdude">avrdude</a>
		
			
			<a class="ui label violet " href="/tags/esp8266" title="esp8266">esp8266</a>
		
			
			<a class="ui label violet " href="/tags/linux" title="linux">linux</a>
		
	


		</section>
	

	
	
		<section class="ui attached inverted segment sidebar-dream-categories both flexbox">
			<div class="ui inverted accordion">
				
	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/avr">avr</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/atmelstudio_usbasp/">
				<div>
					<i class="cocktail icon"></i>
					<p>USBasp w AtmelStudio</p>
				</div>
			</a>
		
	</div>

	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/domoticz">domoticz</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/gniazdko_smartdgm/">
				<div>
					<i class="cocktail icon"></i>
					<p>Gniazdko SmartDGM</p>
				</div>
			</a>
		
			<a class="item" href="https://majki09.github.io/posts/brak-ruchu-w-domu/">
				<div>
					<i class="cocktail icon"></i>
					<p>Wykrywanie domownik贸w w Domoticz</p>
				</div>
			</a>
		
	</div>

	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/raspberry">raspberry</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/rc5/">
				<div>
					<i class="cocktail icon"></i>
					<p>Raspberry Pi na pilota</p>
				</div>
			</a>
		
	</div>


			</div>
		</section>
	

	
	<section id="footer" class="ui bottom attached center aligned inverted segment">
		

	<p>漏 2019 majki-blog</p>


<p>Zasilane przez <a href="https://gohugo.io/" target="_blank">Hugo</a> z motywem <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus.</a></p>

	</section>
</div>


		<div class="pusher">
			<div class="flipper">
				<div class="front">
					
	<nav class="ui top secondary menu bar">
	
	<div class="item">
		<i class="inverted big link bullseye icon dream-flip-toggle" title="O mnie kilka s贸w"></i>
	</div>

	
	
		<div class="item">
			<a href="/">
				<i class="inverted big link home icon" title="G贸wna strona"></i>
			</a>
		</div>
	

	
	

	
	
		<div class="item">
			<a href="/tags">
				<i class="inverted big link tags icon" title="Wszystkie tagi"></i>
			</a>
		</div>
	

	
	
		<div class="item">
			<a href="/categories">
				<i class="inverted big link cubes icon" title="Wszystkie kategorie"></i>
			</a>
    	</div>
	

	
	

	
	
		<div class="ui container tablet computer only grid">
			<div class="item" onClick="$('.ui.sidebar').sidebar('setting', 'transition', 'overlay').sidebar('toggle');">
				<i class="inverted big link sidebar icon" title="Pokazuj boczny pasek"></i>
			</div>
		</div>
	

	
	
		<div class="item right">
			<a href="/posts/index.xml">
				<i class="inverted big link rss icon" title="RSS"></i>
			</a>
		</div>
	
</nav>


	<div class="ui centered grid">
		
		<div class="sixteen wide mobile only column">
				<div class="ui inverted accordion">
	<div id="header" class="ui inverted segment column box">		
		
		<header id="author" class="ui top attached center aligned inverted segment">
			
<div class="ui small circular image">
	
		<img src="/images/ja_awatar.png">
	
</div>


<h3 class="ui header">
	majki
	<div class="sub header">Wszystko jest mo偶liwe - niemo偶liwe potrzebuje tylko wicej czasu.</div>
</h3>

		</header>

		
		<div class=" title header-title">
			
				<div id="tag-category-pop" class="ui red right corner label">
					<i class="hand point icon down" title="Poka偶/ukryj tagi i kategorie"></i>
				</div>
			
		</div>
		
		
		<div id="tag-category" class=" content">
			
				<section class="ui attached center aligned inverted segment dream-tags none flexbox">
					
					
					




	
	
		
			
			<a class="ui label red " href="/tags/domoticz" title="domoticz">domoticz</a>
		
			
			<a class="ui label brown " href="/tags/programowanie" title="programowanie">programowanie</a>
		
			
			<a class="ui label blue " href="/tags/raspberry" title="raspberry">raspberry</a>
		
			
			<a class="ui label brown " href="/tags/atmelstudio" title="atmelstudio">atmelstudio</a>
		
			
			<a class="ui label teal " href="/tags/avr" title="avr">avr</a>
		
			
			<a class="ui label brown " href="/tags/avrdude" title="avrdude">avrdude</a>
		
			
			<a class="ui label yellow " href="/tags/esp8266" title="esp8266">esp8266</a>
		
			
			<a class="ui label red " href="/tags/linux" title="linux">linux</a>
		
	


				</section>
			

			
				<section class="ui attached inverted segment dream-categories both flexbox">
					<div class="inverted accordion">
						
	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/avr">avr</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/atmelstudio_usbasp/">
				<div>
					<i class="cocktail icon"></i>
					<p>USBasp w AtmelStudio</p>
				</div>
			</a>
		
	</div>

	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/domoticz">domoticz</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/gniazdko_smartdgm/">
				<div>
					<i class="cocktail icon"></i>
					<p>Gniazdko SmartDGM</p>
				</div>
			</a>
		
			<a class="item" href="https://majki09.github.io/posts/brak-ruchu-w-domu/">
				<div>
					<i class="cocktail icon"></i>
					<p>Wykrywanie domownik贸w w Domoticz</p>
				</div>
			</a>
		
	</div>

	
	<div class="title">
		<i class="dropdown icon"></i>
		<a class="link" href="/categories/raspberry">raspberry</a>
	</div>

	
	<div class="content">
		
			<a class="item" href="https://majki09.github.io/posts/rc5/">
				<div>
					<i class="cocktail icon"></i>
					<p>Raspberry Pi na pilota</p>
				</div>
			</a>
		
	</div>


					</div>
				</section>
			
		</div>

		
		<footer class="ui bottom attached center aligned inverted segment">
			

	<p>漏 2019 majki-blog</p>


<p>Zasilane przez <a href="https://gohugo.io/" target="_blank">Hugo</a> z motywem <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus.</a></p>

		</footer>
	</div>
</div>

		</div>

		<div class="sixteen wide mobile fifteen wide tablet twelve wide computer column post-list">
			
			<section class="ui secondary top attached black segment post-head">
				<h1 class="post-title">
					Gniazdko SmartDGM
				</h1>

				<div class="sub header">
					<div><span><i class="calendar outline icon"></i>1.09.2019</span></div>
					
					<div><span class="disqusComment"><i class="comment outline icon"></i><a href="https://majki09.github.io/posts/gniazdko_smartdgm/#disqus_thread" class="disqus-comment-count" data-disqus-identifier="36310a20cb664ba6ed0e2ccac0d2a4ed"></a></span></div>
					<div><span><i class="clock outline icon"></i>8 min czytania</span></div>
					<div><span><i class="angle double up icon"></i>Ostatnia zmiana 1.09.2019</span></div>
				</div>
				<hr>

				
					<div class="toc">
						<nav id="TableOfContents">
<ul>
<li><a href="#godne-uwagi-smart-gniazdko-w-ofercie-biedronki">Godne uwagi smart gniazdko w ofercie Biedronki</a></li>
<li><a href="#otwieramy-puszk-pandory">Otwieramy puszk Pandory</a>
<ul>
<li><a href="#wntrznoci-gniazdka">Wntrznoci gniazdka</a></li>
<li><a href="#wycigamy-pytk-z-gniazdka">Wycigamy pytk z gniazdka</a></li>
<li><a href="#podczamy-kable-do-programowania">Podczamy kable do programowania</a></li>
</ul></li>
<li><a href="#wgrywamy-tasmota">Wgrywamy Tasmota</a>
<ul>
<li><a href="#spos贸b-bez-backupu">Spos贸b bez backupu</a>
<ul>
<li><a href="#czego-potrzebujesz">Czego potrzebujesz</a></li>
<li><a href="#jedziemy-z-koksem">Jedziemy z koksem</a></li>
</ul></li>
<li><a href="#spos贸b-z-backupem">Spos贸b z backupem</a>
<ul>
<li><a href="#czego-potrzebujesz-1">Czego potrzebujesz</a></li>
<li><a href="#podczenie-moduu-do-raspberrypi">Podczenie moduu do RaspberryPi</a></li>
<li><a href="#wgrywamy-soft">Wgrywamy soft</a></li>
</ul></li>
</ul></li>
<li><a href="#skadanie-gniazdka-do-kupy">Skadanie gniazdka do kupy</a></li>
<li><a href="#konfiguracja">Konfiguracja</a></li>
<li><a href="#mqtt">MQTT</a></li>
<li><a href="#domoticz">Domoticz</a>
<ul>
<li><a href="#konfiguracja-mqtt">Konfiguracja MQTT</a></li>
<li><a href="#dodajemy-przecznik-i-miernik-zu偶ycia-energii">Dodajemy przecznik i miernik zu偶ycia energii</a></li>
</ul></li>
<li><a href="#bonus">Bonus</a>
<ul>
<li><a href="#kalibracja-pomiaru-prdu">Kalibracja pomiaru prdu</a></li>
</ul></li>
<li><a href="#linki">Linki</a></li>
<li><a href="#podsumowanie">Podsumowanie</a></li>
</ul>
</nav>
					</div>
				

				<article class="post-content twemoji">
					

<h1 id="godne-uwagi-smart-gniazdko-w-ofercie-biedronki">Godne uwagi smart gniazdko w ofercie Biedronki&nbsp;<a class="anchor" href="#godne-uwagi-smart-gniazdko-w-ofercie-biedronki"><i class="small linkify icon"></i></a> </h1>

<p>Gniazdko <strong>SmartDGM</strong> wyjte z blistra jest gotowe do u偶ycia niemal od razu. Wystarczy kr贸tka konfiguracja i jestemy w stanie sterowa gniazdkiem niemal z ka偶dego miejca na wiecie. A co, jeli mamy ju偶 chocia偶by <strong>Domoticza</strong> i chcemy to gniazdko z nim zintegrowa? Dobrym sposobem na to jest zmiana softu i wgranie open-sourcowego <strong>Tasmota</strong>. Zapraszam do poradnika :)</p>

<blockquote>
<p>Zanim ruszymy dalej upewnijmy si, 偶e:</p>

<ul>
<li>umiesz si posugiwa lutownic,</li>
<li>znasz podstawy elektroniki (musisz chocia偶by wiedzie, 偶eby <strong>odczy</strong> gniazdko od sieci 230V zanim zaczniesz w nim grzeba :D ).</li>
</ul>
</blockquote>

<h1 id="otwieramy-puszk-pandory">Otwieramy puszk Pandory&nbsp;<a class="anchor" href="#otwieramy-puszk-pandory"><i class="small linkify icon"></i></a> </h1>

<p>Na dzie dzisiejszy nie istnieje 偶aden skuteczny <strong>OTA hack</strong> na t wersj softu i trzeba programowa przewodowo. Niestety konstrukcja gniazdka uniemo偶liwia atwe podczenie si do pin贸w programowania. Gniazdko jest sklejone i trzeba je otworzy, a najlepiej to zrobi, wsuwajc co cienkiego (np. <strong>no偶yk/skalpel</strong> jak zwa, tak zwa) w szczeliny po bokach przy wystajcych bolcach.</p>

<p>Po otwarciu uka偶e nam si widok:
<img src="/images/smartDGM/2.jpg" alt="1" title="Pytka z widocznymi moduami TYWE2S i BL0937" /></p>

<h2 id="wntrznoci-gniazdka">Wntrznoci gniazdka&nbsp;<a class="anchor" href="#wntrznoci-gniazdka"><i class="small linkify icon"></i></a> </h2>

<p>W skad gniazdka <strong>smartDGM</strong> wchodz:</p>

<ul>
<li>bazujcy na ESP modu WiFi <strong>TYWE2S</strong>,</li>
<li>modu do pomiar贸w napicia, prdu i energii <strong>BL0937</strong>,</li>
<li>1 jednokolorowa dioda LED,</li>
<li>1 przycisk,</li>
<li>1 przeka藕nik,</li>
<li>inne klamoty potrzebne do dziaania :).</li>
</ul>

<h2 id="wycigamy-pytk-z-gniazdka">Wycigamy pytk z gniazdka&nbsp;<a class="anchor" href="#wycigamy-pytk-z-gniazdka"><i class="small linkify icon"></i></a> </h2>

<p>呕eby dobra si do linii <strong>3V3</strong>, <strong>GND</strong>, <strong>RX</strong> i <strong>TX</strong> trzeba wyj pytk z gniazdka. A 偶eby wyj pytk z gniazdka wystarczy wylutowa j w <strong>trzech miejscach</strong>:</p>

<p><img src="/images/smartDGM/5_desolder.jpg" alt="text" title="W tych miejscach odlutuj pytk od reszty gniazdka" /></p>

<p><strong>Kabel uziemienia</strong> najlepiej tymczasowo odlutowa przy pytce, bez niego bdzie du偶o atwiej z dalszymi krokami.</p>

<h2 id="podczamy-kable-do-programowania">Podczamy kable do programowania&nbsp;<a class="anchor" href="#podczamy-kable-do-programowania"><i class="small linkify icon"></i></a> </h2>

<p>Po wycigniciu pytki przylutuj <strong>4 kable</strong> do pad贸w tak jak na zdjciu:</p>

<p><img src="/images/smartDGM/7.jpg" alt="1" title="Pinout moduu TYWE2S i podczenie do programowania" /></p>

<h1 id="wgrywamy-tasmota">Wgrywamy Tasmota&nbsp;<a class="anchor" href="#wgrywamy-tasmota"><i class="small linkify icon"></i></a> </h1>

<p>W zale偶noci od tego, czy potrzebujesz backupu oryginalnego wsadu pamici (偶eby m贸c potem wr贸ci do oryginau) wybierz jeden z dw贸ch sposob贸w:</p>

<ul>
<li><a href="#spos贸b-bez-backupu">bez backupu - prostszy</a>,</li>
<li><a href="#spos贸b-z-backupem">z backupem - trudniejszy</a>.</li>
</ul>

<h2 id="spos贸b-bez-backupu">Spos贸b bez backupu&nbsp;<a class="anchor" href="#spos贸b-bez-backupu"><i class="small linkify icon"></i></a> </h2>

<p>Ten spos贸b jest du偶o atwiejszy, ale nie ma mo偶liwoci zrobienia backupu oryginalnego softu (poniewa偶 na dzie dzisiejszy <strong>NodeMCU PyFLasher</strong> nie obsuguje komendy <em>read_flash</em>). Wybierz ten spos贸b, jeli nie potrzebujesz backupu oryginalnego softu.</p>

<h3 id="czego-potrzebujesz">Czego potrzebujesz&nbsp;<a class="anchor" href="#czego-potrzebujesz"><i class="small linkify icon"></i></a> </h3>

<ul>
<li>komputer PC,</li>
<li>NodeMCU PyFlasher - do pobrania <a href="https://github.com/marcelstoer/nodemcu-pyflasher/releases">std</a></li>
<li>konwerter <strong>USB-UART</strong> (mile widziany CH341, bo ma wyprowadzenie 3V3 do zasilenia moduu),</li>
<li>binark <strong>sonoffa</strong> pobran z <a href="https://github.com/arendst/Sonoff-Tasmota/releases/">GitHuba projektu Tasmota</a>.</li>
</ul>

<h3 id="jedziemy-z-koksem">Jedziemy z koksem&nbsp;<a class="anchor" href="#jedziemy-z-koksem"><i class="small linkify icon"></i></a> </h3>

<ol>
<li>Podczamy przylutowane kable RX, TX i GND do konwertera USB-UART.</li>
<li>Zwieramy <strong>GPIO0</strong> do <strong>GND</strong> - chwilowo albo jak kto woli przylutowa kabelkiem na czas programowania - chodzi tutaj o wprowadzenie moduu w tryb programowania.</li>
<li>Zasilamy modu kablem 3V3 - najlepiej, gdy Tw贸j konwerter USB-UART ma wyprowadzenie z tym napiciem.</li>
<li>Wybieramy <em>Serial port</em> konwertera w PyFlasherze i wybieramy plik z <em>firmware</em> sonoff&rsquo;a.</li>
<li><em>Erase flash</em> ustawiamy na <strong>yes, wipes all data</strong>.
<img src="/images/smartDGM/pyflasher_win.png" alt="Przykadowy wygld NodeMCU PyFlasher" title="Przykadowy wygld NodeMCU PyFlasher" /></li>
<li>Wciskamy <em>Flash NodeMCU</em> i czekamy na koniec programowania.</li>
<li>Jeli wszystko OK przechodzimy do <a href="#skadanie-gniazdka-do-kupy">skadania gniazdka</a>.</li>
</ol>

<h2 id="spos贸b-z-backupem">Spos贸b z backupem&nbsp;<a class="anchor" href="#spos贸b-z-backupem"><i class="small linkify icon"></i></a> </h2>

<p>Spos贸b ten jest nieco trudniejszy, ale za to z mo偶liwoci backupu oryginalnego wsadu.</p>

<h3 id="czego-potrzebujesz-1">Czego potrzebujesz&nbsp;<a class="anchor" href="#czego-potrzebujesz-1"><i class="small linkify icon"></i></a> </h3>

<ul>
<li>komputer PC,</li>
<li>RaspberryPi z <strong>Raspbianem</strong>,</li>
<li>binark <strong>sonoffa</strong> pobran z <a href="https://github.com/arendst/Sonoff-Tasmota/releases/">GitHuba projektu Tasmota</a>,</li>
</ul>

<blockquote>
<p>Poni偶sze kroki mo偶na te偶 wykona bez RaspberryPi - chocia偶by na <strong>Windowsie</strong>. W takim przypadku trzeba mie zainstalowany interpreter <strong>Pythona</strong> i esptool. Wybraem spos贸b z malin, 偶eby byo ciekawiej :)</p>
</blockquote>

<h3 id="podczenie-moduu-do-raspberrypi">Podczenie moduu do RaspberryPi&nbsp;<a class="anchor" href="#podczenie-moduu-do-raspberrypi"><i class="small linkify icon"></i></a> </h3>

<p>Wszystkie <strong>4 kable</strong> przylutowane do moduu podcz do <strong>RaspberryPi</strong>, pamitajc przy tym, 偶e podczasz RX moduu do TXa Raspberry i TX moduu do RXa Raspberry. <strong>Nie pomyl 3V3 z 5V</strong>, bo z moduu p贸jdzie dym i dalej ju偶 nic nie bdziesz musia robi (jedynie posprzta na stole) :P</p>

<h3 id="wgrywamy-soft">Wgrywamy soft&nbsp;<a class="anchor" href="#wgrywamy-soft"><i class="small linkify icon"></i></a> </h3>

<blockquote>
<p><strong>UWAGA!</strong> Pamitaj, 偶e po ka偶dym dziaaniu na pamici przez <em>esptool&rsquo;a</em> (czyli po ka偶dym z poni偶szych krok贸w) modu WiFi <strong>wychodzi</strong> z <em>trybu programowania</em>. Przed ka偶dym krokiem z <em>esptool&rsquo;em</em> wprowad藕 modu w <em>tryb programowania</em> - najlepiej uruchomi go ponownie zwierajc <strong>GPIO0</strong> do GND.</p>
</blockquote>

<ol>
<li><p>Robimy <strong>backup</strong> oryginalnego wsadu z pamici komend <em>read_flash</em>, binarka ze zgranym wsadem bdzie w pliku <em>DGM_backup.bin</em>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh">pi@raspdebug:~/esptool $ ./esptool.py --port /dev/ttyAMA0 read_flash 0x00000 0x100000 DGM_backup.bin
esptool.py v2.8-dev
Serial port /dev/ttyAMA0
Connecting...
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: 2c:f4:32:b4:4c:99
Uploading stub...
Running stub...
Stub running...
1048576 (100 %)
1048576 (100 %)
Read 1048576 bytes at 0x0 in 95.1 seconds (88.3 kbit/s)...
Hard resetting via RTS pin...</code></pre></td></tr></table>
</div>
</div></li>

<li><p><strong>Kasujemy</strong> ca zawarto pamici (bez tego mo偶esz mie potem problemy z dziaaniem gniazdka, poza tym zawsze kasuje si pami przed programowaniem):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh">pi@raspdebug:~/esptool $ ./esptool.py --port /dev/ttyAMA0 erase_flash
esptool.py v2.8-dev
Serial port /dev/ttyAMA0
Connecting....
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: 2c:f4:32:b4:4c:99
Uploading stub...
Running stub...
Stub running...
Erasing flash (this may take a while)...
Chip erase completed successfully in 3.4s
Hard resetting via RTS pin...</code></pre></td></tr></table>
</div>
</div></li>

<li><p><strong>Flashujemy</strong> gniazdko nowym softem Tasmota:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh">pi@raspdebug:~/esptool $ ./esptool.py --port /dev/ttyAMA0 write_flash -fs 1MB -fm dout 0x0 ./sonoff.bin
esptool.py v2.8-dev
Serial port /dev/ttyAMA0
Connecting....
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: 2c:f4:32:b4:4c:99
Uploading stub...
Running stub...
Stub running...
Configuring flash size...
Compressed 515872 bytes to 355877...
Wrote 515872 bytes (355877 compressed) at 0x00000000 in 32.9 seconds (effective 125.4 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...</code></pre></td></tr></table>
</div>
</div></li>

<li><p>Robimy <strong>restart</strong> gniazdka poprzez odczenie i ponowne podczenie <strong>zasilania 3.3V</strong> - wtedy ruszy inicjalizacja Tasmota i pierwszy rozruch moduu.</p></li>
</ol>

<h1 id="skadanie-gniazdka-do-kupy">Skadanie gniazdka do kupy&nbsp;<a class="anchor" href="#skadanie-gniazdka-do-kupy"><i class="small linkify icon"></i></a> </h1>

<blockquote>
<p><strong>UWAGA!</strong> Zanim wszystko polutujesz i posklejasz z powrotem sprawd藕 sobie, czy Tasmota w og贸le 偶yje. Zostaw zasilanie 3.3V podczone i potestuj modu. Wgraj <a href="#konfiguracja">konfiguracj</a> i to powinno ju偶 da jaki obraz, 偶e jest sens i dalej :) Dopiero jeli mo偶esz wej do ustawie Tasmota zlutuj pytk z powrotem i potestuj pomiar napicia, itp. Jeli nie - spr贸buj jeszcze raz skasowa pami i wgra Tasmota.</p>
</blockquote>

<ol>
<li>Jeli wszystko dziaa i wyglda dobrze odcz i odlutuj wszystkie kable i z贸偶 gniazdko w cao. Najlepiej jest je z powrotem sklei, bo przy odczaniu z gniazdka 230V gniazdko si rozleci w doni i <strong>mo偶e kopn prdem</strong>!</li>
<li>Po wyschniciu kleju wpinamy gniazdko do 230V i przechodzimy do <a href="#konfiguracja">konfiguracji</a>.</li>
</ol>

<h1 id="konfiguracja">Konfiguracja&nbsp;<a class="anchor" href="#konfiguracja"><i class="small linkify icon"></i></a> </h1>

<p>W menu Tasmota wchodzimy do <em>Configuration</em>, potem do <em>Configure module</em>.
Prawidowy konfig dla tego gniazdka to:</p>

<!---
Typ urzdzenia - **generic**. Podczenie:

 - gpio3 button1,
 - gpio13 led1i,
 - gpio14 relay1,
 - gpio4 bl0937 cf,
 - gpio5 hlwbl cf1,
 - gpio12 hlwbl seli.
-->

<p><img src="/images/smartDGM/tasmota_config.png" alt="tasmota_config" title="Prawidowa konfiguracja Tasmota" /></p>

<p>Poprawnie skonfigurowany <strong>Tasmota</strong> w naszym gniazdku wyglda tak:
<img src="/images/smartDGM/tasmota_configured.png" alt="tasmota_ok" title="Przykadowy widok skonfigurowanego Tasmota" /></p>

<h1 id="mqtt">MQTT&nbsp;<a class="anchor" href="#mqtt"><i class="small linkify icon"></i></a> </h1>

<p><strong>Tasmota</strong> wykorzystuje protok贸 <strong>MQTT</strong> do komunikacji z reszt urzdze. Zajmijmy si teraz jego konfiguracj.</p>

<ol>
<li><p><strong>Brokera MQTT</strong> najlepiej zainstalowa na urzdzeniu, kt贸re hostuje Domoticz&rsquo;a. Instalujemy <em>mosquitto</em> i tworzymy konto (np. <em>pi</em>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh">sudo apt-get update
sudo apt-get install mosquitto mosquitto-clients
sudo mosquitto_passwd -c /etc/mosquitto/passwd pi</code></pre></td></tr></table>
</div>
</div></li>

<li><p>Tym poleceniem bdziemy podsuchiwa <strong>komunikaty MQTT</strong> nadawane przez nasze <strong>gniazdko</strong> (zauwa偶, 偶e Domoticz ju偶 nadaje). Uruchom to polecenie i tymczasowo trzymaj konsol gdzie z boku.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ssh" data-lang="ssh">mosquitto_sub -h localhost -t &#34;#&#34; -u &#34;pi&#34; -P &#34;tajnehaslo&#34; -v</code></pre></td></tr></table>
</div>
</div></li>

<li><p>Wchodzimy do <strong>menu Tasmota</strong> i kolejno do <em>Configuration</em>, <em>Configure MQTT</em>.</p></li>

<li><p>W polu <em>Host</em> wpisujemy <em>hostname&rsquo;a</em> urzdzenia z domoticzem, albo w ostatecznoci jego <strong>adres IP</strong>; port domylny <strong>1883</strong> oraz nazw u偶ytkownika z <em>mosquitto</em> i haso.</p></li>

<li><p>Klikamy <em>Save</em>.</p></li>
</ol>

<h1 id="domoticz">Domoticz&nbsp;<a class="anchor" href="#domoticz"><i class="small linkify icon"></i></a> </h1>

<h2 id="konfiguracja-mqtt">Konfiguracja MQTT&nbsp;<a class="anchor" href="#konfiguracja-mqtt"><i class="small linkify icon"></i></a> </h2>

<ol>
<li>Wchodzimy w zakadk <em>Sprzt</em> i dodajemy <em>MQTT Client Gateway with LAN interface</em>.</li>

<li><p>Wklepujemy <strong>konfiguracj MQTT</strong> zgodnie z poni偶szym obrazkiem
<img src="/images/smartDGM/domoticz_mqtt.png" alt="MQTT" title="Konfiguracja MQTT w Domoticz" /></p>

<blockquote>
<p><strong>UWAGA!</strong> Pole <em>Adres zdalny</em> najlepiej ustawi <strong>dynamicznie</strong>, czyli <em>localhost</em> albo <em>127.0.0.1</em>. W przeciwnym wypadku bdzie zdziwko, 偶e nagle wszystko przestao dziaa, bo router zmieni adresy IP.</p>
</blockquote></li>

<li><p>Wciskamy <em>Dodaj</em>.</p></li>
</ol>

<h2 id="dodajemy-przecznik-i-miernik-zu偶ycia-energii">Dodajemy przecznik i miernik zu偶ycia energii&nbsp;<a class="anchor" href="#dodajemy-przecznik-i-miernik-zu偶ycia-energii"><i class="small linkify icon"></i></a> </h2>

<ol>
<li>W zakadce <em>Sprzt</em> dodajemy <em>Dummy switch</em>, wpisujemy nazw, a z listy wybieramy <strong>Przecznik</strong>. Bdzie to nasz <em>ON/OFF</em> w Domoticz.
<img src="/images/smartDGM/domoticz_dummy_switch.png" alt="dummy_switch" title="Dodaj Przecznik" /></li>
<li>Analogicznie dodajemy <strong>miernik zu偶ycia energii</strong>, wybierajc z listy <em>Elektryczno (Chwilowa+Licznik)</em>.</li>
<li>Wchodzimy do zakadki <em>Urzdzenia</em> i wyszukujemy przed chwil dodane <em>Virtual Sensory</em>
<img src="/images/smartDGM/domoticz_devices.png" alt="devices" title="Virtual Sensory w zakadce Urzdzenia" /></li>
<li>Ich <strong>numery IDX</strong> musimy wpisa do konfiguracji <strong>Tasmota</strong>. W tym celu wchodzimy do <em>Configuration</em> i <em>Configure Domoticz</em> w menu <strong>Tasmota</strong>.
<img src="/images/smartDGM/tasmota_domoticz.png" alt="tasmota_domoticz" title="Konfiguracja IDX w Tasmota" /></li>
<li>Klikamy <em>Save</em> i w okienku podsuchiwacza <strong>komunikat贸w MQTT</strong> powinny ukaza si dane od <strong>naszego gniazdka</strong>. Jeli nie, sprawd藕 konfiguracj <strong>Tasmota</strong> i <strong>Domoticz MQTT</strong>.</li>
</ol>

<h1 id="bonus">Bonus&nbsp;<a class="anchor" href="#bonus"><i class="small linkify icon"></i></a> </h1>

<h2 id="kalibracja-pomiaru-prdu">Kalibracja pomiaru prdu&nbsp;<a class="anchor" href="#kalibracja-pomiaru-prdu"><i class="small linkify icon"></i></a> </h2>

<p>Kiedy odczyty napicia lub pobieranej mocy s jakby zawy偶one/zani偶one nale偶y zrobi <strong>kalibracj</strong>. Mo偶emy do tego wykorzysta miernik poboru mocy (dostpne w sklepach elektro) albo prosty spos贸b podczajc do naszego gniazdka <strong>zwyk 偶ar贸wk</strong> o znanej mocy (np. 60W, 100W itp.) i w konsoli <strong>Tasmota</strong> wpisa:</p>

<ul>
<li>PowerSet 60,</li>
<li>VoltageSet 240,</li>
<li>CurrentSet 250.</li>
</ul>

<p>Po tym zabiegu Tasmota powinien pokaza ju偶 &ldquo;lepsze&rdquo; wyniki pomiaru. A jeli <em>Power factor</em> wynosi <strong>1.00</strong> mo偶emy uzna, 偶e kalibracja przesza prawidowo.</p>

<blockquote>
<p><strong>UWAGA!</strong> Wartoci <em>Wykorzystanie energii</em> w Domoticz mog nieznacznie odbiega od tego, co mamy w module <strong>Tasmota</strong> (Wartoci <em>Energy Today/Yesterday</em>). Wyglda na to, 偶e Tasmota okresowo (domylnie co 5 min) wysya 2 wartoci: <strong>pob贸r mocy</strong> i <strong>wykorzystan energi</strong> (<em>Energy Total</em>), a Domoticz, bazujc na tych wartociach urednia wyniki co ka偶d godzin.</p>
</blockquote>

<h1 id="linki">Linki&nbsp;<a class="anchor" href="#linki"><i class="small linkify icon"></i></a> </h1>

<ul>
<li><a href="https://github.com/arendst/Sonoff-Tasmota/wiki">wiki projektu Tasmota</a></li>
<li><a href="https://github.com/arendst/Sonoff-Tasmota/wiki/Flashing">wiki nt. flashowania Tasmota</a></li>
</ul>

<h1 id="podsumowanie">Podsumowanie&nbsp;<a class="anchor" href="#podsumowanie"><i class="small linkify icon"></i></a> </h1>

<p>Jeli dotrwae do tego miejsca to moje gratulacje! Dalej wszystko powinno by dziecinnie proste. Przed Tob wczanie, wyczanie i dokadne monitorowanie poboru energii jakiegokolwiek urzdzenia, kt贸re podepniesz do Twojego nowego <strong>smart gniazdka</strong> - i to wszystko z poziomu Domoticz&rsquo;a!</p>

<p>Daj zna <strong>w komentarzach</strong>, jeli wg Ciebie czego brakuje w tekcie, co nie dziaa albo po prostu czy Ci si podoba taka forma poradnika. Ja ze swojej strony dzikuj Ci za powicony czas i do nastpnego poradnika!</p>

<blockquote>
<p><strong>ACHTUNG!</strong> Powy偶sza instrukcja su偶y wycznie celom edukacyjnym. Wszystko to robisz na wasn odpowiedzialno, a autor nie bierze odpowiedzialnoci za szkody powstae w wyniku nierozwa偶nych dziaa.</p>
</blockquote>

				</article>				
			</section>

			
			<section class="ui secondary attached segment dream-tags">
				
					




	
		<a class="ui label red " href="/tags/linux" title="linux">linux</a>
	
		<a class="ui label olive " href="/tags/raspberry" title="raspberry">raspberry</a>
	
		<a class="ui label blue " href="/tags/esp8266" title="esp8266">esp8266</a>
	
		<a class="ui label green " href="/tags/domoticz" title="domoticz">domoticz</a>
	
		<a class="ui label purple " href="/tags/tasmota" title="tasmota">tasmota</a>
	


				
			</section>

			
			
				<section class="ui secondary  attached segment share row box">
					








<div class="author">
	
	<img class="avatar" src="/images/ja_awatar.png">
	
</div>
<div class="info grow flexbox">
	
	<p class="name">majki</p>
	
	<p class="desc">Wszystko jest mo偶liwe - niemo偶liwe potrzebuje tylko wicej czasu.</p>
</div>


<section class="buttons row box">
	<div class="facebook none flexbox" href="#" onclick="window.open(
			'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
			'facebook-share-dialog',
			'width=626,height=436'); return false;">
		<button class="ui facebook button"><i class="facebook icon"></i>Udostpnij</button>
	</div>
	<div class="twitter none flexbox" onclick="window.open('https://twitter.com/intent/tweet?text=Read &quot;Gniazdko SmartDGM  https:\/\/majki09.github.io\/posts\/gniazdko_smartdgm\/','_self')">
		<button class="ui twitter button"><i class="twitter icon"></i>Tweet</button>
	</div>
</section>

				</section>
			

			
			
								
				<section class="ui secondary attached segment copyright">
					




<div class="row box">
	<a rel="license" class="license image none flexbox" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
		<img alt="Creative Commons License" src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png" style="border-width: 0"></img>
	</a>
	<span class="license statement both flexbox">
		Ten wpis jest na licencji
		<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
	</span>
</div>
				</section>
			

			
			
				<div class="ui secondary bottom attached stacked segment disqus">
					
<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
		this.page.url = 'https:\/\/majki09.github.io\/posts\/gniazdko_smartdgm\/';
		this.page.identifier = '36310a20cb664ba6ed0e2ccac0d2a4ed';
	};
	(function() {
   	var d = document, s = d.createElement('script');
   	s.src = 'https://' + 'majki-blog' + '.disqus.com/embed.js';
   	s.setAttribute('data-timestamp', +new Date());
   	(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

				</div>
			
		</div>
	</div>

				</div>
				<div class="back">
					
<nav class="ui top secondary menu bar">
	<div class="item">
		<i class="inverted big link bullseye icon dream-flip-toggle" title="O mnie kilka s贸w"></i>
	</div>
	
		
	
		
	

	
	
	
	
	
	
	
		
		
			<div class="item">
				<a href="https://github.com/majki09" target="	_blank">
					<i id="ico" class="inverted big link github icon" title="GitHub"></i>
				</a>
			</div>
		
	
		
		
	
		
		
	
		
		
	
		
		
	
		
		
	
		
		
			<div class="item">
				<a href="https://www.stackoverflow.com/users/8344456/majki" target="	_blank">
					<i id="ico" class="inverted big link stack overflow icon" title="Stack Overflow"></i>
				</a>
			</div>
		
	
		
		
	
		
		
	
</nav>



<div class="ui centered grid about">
	<div class="sixteen wide mobile fifteen wide tablet fifteen wide computer column about">
		<section class="ui stacked segments">
			<div class="ui inverted segment">
				<article class="twemoji">
					<h1>Kim jestem?</h1>

<p>Nazywam si ukasz Majkut.</p>

<p>Lubi elektronik i wikszo co zwizana z komputerami, czyli od programowania, po obr贸bk obrazu i wideo.</p>

<p>Ciekawi mnie te偶 <strong>fotografia</strong>, w sumie to od zawsze ciekawia. Czy jestem <strong>fotografem</strong>? Jeli fotograf, to osoba, kt贸ra robi zdjcia to tak, jestem fotografem . Ju偶 niebawem na tym blogu powstan wpisy na temat wanie fotografii, bdzie co o podstawach, jak i obr贸bce zdj w <strong>Lightroomie</strong>.</p>

<p>Od czterech lat pracuj jako in偶ynier <a href="https://en.wikipedia.org/wiki/In-circuit_test">ICT</a> w du偶ej firmie w Krakowie. Jest to praca polegajca na testowaniu <strong>elektroniki</strong>, ale s te偶 elementy <strong>programowania</strong>. Praca jest bardzo specyficzna, a jedna fikstura do test贸w mo偶e zawiera <strong>5km</strong> kabli i wa偶y <strong>45kg!</strong></p>

<p>Zapraszam te偶 do zwiedzenia mojego profilu na <strong>githubie</strong>, poprzez kliknicie na ikonk powy偶ej.</p>

<p><h1>Blog</h1>
Ten blog powsta og贸lnie po to, 偶eby zebra w cao niekt贸re z moich udanych pomys贸w w jednym miejscu. Nie raz, 偶eby zrobi co ciekawego musiaem przekopywa si przez ton informacji nie tylko z Internetu. Mam nadziej, 偶e dziki moim wpisom Ty ju偶 nie bdziesz musiaa / musia tego robi  .</p>

<p>Blog jest te偶 takim moim portfolio, czym, czym mog si spokojnie pochwali.</p>

<!---
commented out by majki
Im just another teenager who likes **writing**, **programming** and **making stuff**. Even setting the title as **Who Am I**  for this article is reminding me of `whoami` in Linux. I feel the inner urge to contribute something to the Internet because I love writing and I believe posting something online enables users all around the globe to see your work and suggest improvements.

Recently I've also started taking interest in web designing and hosting the fruitful results of which these site and blogs are! I also make **projects** and share them online at **Instructables**, the link of which has been placed on the home page. Making stuff is just one of the things I love the most.

Thats all that I can think of right now. Hopefully Ill add something more to this later on. 

Curious about me? Use the social links above to check out my profiles.

You can also support me on <a href="https://patreon.com/UtkarshVerma" target="_blank">Patreon</a>. I'd really appreciate it.
-->

				</article>
			</div>
		</section>
	</div>
</div>

				</div>
			</div>
		</div>
		
	
	
		<script id="dsq-count-scr" src="//majki-blog.disqus.com/count.js" async></script>
	

		

<script src="/js/site.js"></script>



	<script src="https://twemoji.maxcdn.com/2/twemoji.min.js?2.6"></script>









		


		

	<script>
		(function () {
		  console.log("Twemoji up and making stuff colourful!");
		  for (var b = document.getElementsByClassName("twemoji"), a = 0; a < b.length; a++) {
			twemoji.parse(b[a]);
		  }
		})();
	</script>


	</body>
</html>
